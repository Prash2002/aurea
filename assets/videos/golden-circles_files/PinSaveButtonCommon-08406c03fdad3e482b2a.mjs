(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["PinSaveButtonCommon"],{"2qKt":function(e,t,n){var i=n("q1tI"),a=n("/MKj"),s=(n("17x9"),n("/5zs")),o=n("Vzit"),r=n("vh5K"),c=n("pLLR"),l=n("fArA");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h={shouldUsePlacedExperience:!0,dispatchMountActionDuringSSR:!1};t.a=(e,t={},n)=>d=>{const p=function(e){return t=>{return{experience:t.experiences.eligibleExperiences[e]}}}(e);n=Object.assign({},h,n);const m=function(e,t,n=!0,a=!0,c){return class extends i.Component{constructor(e){super(e),u(this,"state",{extraContext:void 0}),u(this,"setExtraContextState",e=>this.setState({extraContext:e}))}componentDidMount(){this.dispatchPlacementMount(!1)}UNSAFE_componentWillUpdate(n,i){const{dispatch:a,experience:c,requestContext:l}=n,u=new s.c(l,"web_bypass_eligible_experience").enabledWithNoActivation();let h=t;if(u&&"function"==typeof t){const s=t(this.props,this.state);h=t(n,i.extraContext||{}),JSON.stringify(s)!==JSON.stringify(h)&&a(Object(o.c)(e,h,u))}else{if("function"==typeof t){const e=i.extraContext||{};h=t(n,e)}if(!Object(r.d)(c)&&"function"==typeof t&&h&&Object.keys(h).length){const n=t(this.props,this.state);JSON.stringify(n)!==JSON.stringify(h)&&a(Object(o.c)(e,h))}}!c||this.props.experience&&c.id===this.props.experience.id||a(Object(o.i)(e,h))}componentWillUnmount(){const{dispatch:t}=this.props;t(Object(o.k)(e))}dispatchPlacementMount(n){const{dispatch:i,requestContext:a}=this.props;let r={};r="function"==typeof t?t(this.props,this.state):Object.assign({},t);const c=!n&&new s.c(a,"web_bypass_eligible_experience").enabled();i(Object(o.j)(e,r,n,c))}render(){const{experience:e}=this.props;return i.createElement(c,Object.assign({},this.props,{setPlacementExtraContext:this.setExtraContextState,experience:Object(r.d)(e)?e:null}))}}}(e,t,n.shouldUsePlacedExperience,n.dispatchMountActionDuringSSR,d);return Object(l.compose)(c.e,Object(a.connect)(p))(m)}},PNKV:function(e,t,n){},WnNx:function(e,t,n){function i(e){return{type:"SHOW_REPIN_ANIMATION",payload:{pinId:e}}}function a(){return{type:"HIDE_REPIN_ANIMATION"}}function s(){return{type:"SHOW_USECASE_FLYOUT"}}function o(){return{type:"HIDE_USECASE_FLYOUT"}}n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return o}))},dMCU:function(e,t,n){n.d(t,"a",(function(){return c}));var i=n("q1tI"),a=n.n(i),s=n("/MKj"),o=n("v/Q4"),r=n("+PUW");function c(e){const t=t=>{const n=Object(s.useDispatch)(),{isAuth:i,isLimitedLogin:c}=Object(o.a)(),l=!i||c?e=>e=>{e&&e.stopPropagation(),n(r.b)}:e=>e;return a.a.createElement(e,Object.assign({authAction:l,dispatch:n,isAuth:i,isLimitedLogin:c},t))};return t.displayName=`WithAuthenticatedAction(${String(e.displayName||e.name)})`,t}},jZhD:function(e,t,n){n.d(t,"a",(function(){return o}));var i=n("q1tI"),a=(n("17x9"),n("pdBG"));function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o extends i.Component{constructor(...e){super(...e),s(this,"searchCache",Object.create(null)),s(this,"lastSearchedQuery",null),s(this,"search",e=>{this.lastSearchedQuery=e,e in this.searchCache?this.props.onTypeaheadSuggestionsChange(this.searchCache[e],e):this.provider.search(e,({items:t})=>{this.searchCache[e]=t,e===this.lastSearchedQuery&&this.props.onTypeaheadSuggestionsChange(t,e)})})}componentDidMount(){const e=this.props.resourceOptions||{};this.provider=new a.a({resource_name:this.props.resourceName,...e});const{value:t}=this.props;null!=t&&this.props.allowSearchOnMount&&this.search(this.props.value)}UNSAFE_componentWillReceiveProps({value:e}){null!=e&&e!==this.props.value&&this.search(e)}render(){return this.props.children||null}}s(o,"defaultProps",{resourceName:"TypeaheadResource"})},oTtT:function(e,t,n){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c}));var i=n("FZ8N"),a=n("j0Fm");const{Provider:s,useHook:o}=Object(a.a)({name:"board_picker",v2LoggerMetricName:16,sampleRate:i.b?1:.1}),r=s,c=o},pdBG:function(e,t,n){var i=n("AHhP"),a=n.n(i);const s=function(e,t){this.uid=e,this.item=t,this.next=null,this.prev=null},o=function(e){this._maxNumItems=e||10,this._uidToData={},this._numItems=0,this._firstData=null,this._lastData=null};o.prototype.set=function(e,t){let n=this._uidToData[e];n||(n=new s(e,t),this._uidToData[e]=n,this._numItems+=1),this._moveToFront(n),this._numItems>this._maxNumItems&&this._evict()},o.prototype.get=function(e){const t=this._uidToData[e];return t?(this._moveToFront(t),t.item):null},o.prototype.remove=function(e){const t=this._uidToData[e];t&&(delete this._uidToData[e],this._firstData===t&&(this._firstData=t.next),this._lastData===t&&(this._lastData=t.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this._numItems-=1)},o.prototype._moveToFront=function(e){this._firstData!==e&&(this._firstData?(this._lastData===e&&(this._lastData=e.prev),e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this._firstData.prev=e,e.next=this._firstData,e.prev=null,this._firstData=e):(this._firstData=e,this._lastData=e))},o.prototype._evict=function(){delete this._uidToData[this._lastData.uid],this._firstData===this._lastData?(this._firstData=null,this._lastData=null):(this._lastData=this._lastData.prev,this._lastData.next=null),this._numItems-=1};var r=o,c=n("eOdZ"),l=n("mBfy");const u=function(e){e=e||{},this.tags=e.tags,this.enable_recent_queries=!!e.enable_recent_queries,this.minimum_term_character_length=e.minimum_term_character_length||0,this.bypass_lru_cache=e.bypass_lru_cache;const t={tags:e.tags,pin:e.pin_id},n=e.num_places;n?t.num_places=n:t.count="count"in e?e.count:5,e.exclude_non_followers&&(t.exclude_non_followers=!0),e.field_set_key&&(t.field_set_key=e.field_set_key),e.pin_scope&&(t.pin_scope=e.pin_scope),e.suggestion_type&&(t.suggestion_type=e.suggestion_type);let i="TypeaheadResource";e.resource_name&&(i=e.resource_name),this.searchResource=c.a.create(i,t),this.itemsCache=new r};Object.assign(u.prototype,a.a),Object.assign(u.prototype,{search(e,t){let n;if(!e&&"pinners_and_contacts"===this.tags)return this.abortSearch(),this.publishData(e,[],{},t);if(!e&&l.default.isLimitedLogin())return this.abortSearch(),this.publishData(e,[],{},t);if(!e&&this.enable_recent_queries&&l.default&&l.default.isAuthenticated())n="recent_search";else{const n=this.bypass_lru_cache?{}:this.itemsCache.get(e);if(n){const i=n.items;if(i&&i.length){this.abortSearch();const a=n.hint;return void this.publishData(e,i,a,t)}}}e.length>=this.minimum_term_character_length?this.fetch(e,n,t):this.publishData(e,[],{},t)},getResource(){return this.searchResource},abortSearch(){this.getResource().abort()},publishData(e,t,n,i){const a={term:e,items:t,hint:n};this.trigger("data",a),i&&i(a)},setAutocompleteScope(e){this.getResource().set("autocompleteScope",e)},fetch(e,t,n){const i=this.getResource();if(i.isCalling()){const t=i.get("term");if(e===t)return;this.abortSearch()}""!==this.tags&&(i.set("term",e),i.set("tags",t||this.tags),i.resetBookmark(),i.callGet({showError:!1}).then(t=>{const i=t.resource_response.data,a=i.items,s=i.hint||{},o={hint:s,items:a};this.cacheData(e,o),this.publishData(e,a,s,n)},e=>{this.trigger("fetchError",e)}),this.warm=!0)},removeCacheForTerm(e){this.itemsCache.remove(e)},cacheData(e,t){this.itemsCache.set(e,t)},prefetch(){if(this.warm)return;c.a.create("TypeaheadPrepareResource").callGet({showError:!1}),this.warm=!0}});t.a=u},rO08:function(e,t,n){n.r(t),n.d(t,"PinSaveButton",(function(){return O}));var i=n("q1tI"),a=n.n(i),s=n("/MKj"),o=n("Ye/N"),r=n("TiQD"),c=n("rYoy"),l=n("dMCU"),u=n("2qKt"),h=n("n6mq"),d=n("0nTG"),p=n("lm6u"),m=n("y9Ij"),b=n("C0mq"),_=n("B6Tf"),f=n("oTtT"),v=n("pLLR"),g=n("fArA");function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const C=Object(i.lazy)(()=>n.e("FirstPinCreateCommon").then(n.bind(null,"kj35"))),y=[500639,11022];class O extends i.Component{constructor(e){super(e),S(this,"componentWillUnmount",()=>{this._repinCompletionPromise&&this._repinCompletionPromise.cancel()}),S(this,"setCompletionPromise",e=>{this._repinCompletionPromise=e,this._repinCompletionPromise.promise.then(()=>{this.handleRepinHideAndToggle()})}),S(this,"_repinCompletionPromise",null),S(this,"handleRepinHide",()=>{this.setState({isRepinModalOpen:!1})}),S(this,"handleRepinHideAndToggle",()=>{this.setState({isRepinModalOpen:!1});const{onToggleModal:e}=this.props;e&&e(!1)}),S(this,"handleSaveButtonClick",this.props.authAction(e=>{e&&(e.preventDefault(),e.stopPropagation());const{onClickCallback:t,onToggleModal:n,oneTapSave:i,boardPickerStopwatch:a}=this.props;t&&t(),i?i.saved||"function"!=typeof i.save||i.save():(a&&a.start(),n&&n(!0),this.setState({isRepinModalOpen:this.props.isAuth}))})),S(this,"handleSavedButtonClick",()=>{const{history:e,pin:t,pinSavedInfo:n,viewerId:i}=this.props;let a;t.pinner.id===i?a=t.board.url:n&&(a=n.url),a&&e.push(a)}),S(this,"saveButtonRef",Object(i.createRef)()),S(this,"renderPinToBoardRepin",()=>{const{isCloseupPin:e,onToggleModal:t,pin:n}=this.props,{isFPE:i,isRepinModalOpen:s}=this.state;return s&&i?this.renderFPE():i?null:a.a.createElement(p.a,{action:"repin",additionalCreateFields:{is_stl_pin:Object(d.g)(n)},onClose:this.handleRepinHide,setCompletionPromise:this.setCompletionPromise,shouldShowToast:!0,onToggleModal:t,pin:n},({dismissModal:i,displaySuccessAnimation:o,handleAbort:r,handleNewBoardAnimationCompletion:c,handleSocialConnectSet:l,handleSaveToBoard:u,newPin:h,updateDescription:d,modalTitle:p,setModalTitle:m})=>a.a.createElement(_.b,{dismissModal:i,displaySuccessAnimation:o,handleSocialConnectSet:l,handleSaveToBoard:u,anchorRef:this.saveButtonRef.current,handleAbort:r,handleNewBoardAnimationCompletion:c,newPin:h,isCloseupPin:e,isInModal:!0,onToggleModal:t,pin:n,pwtAuxData:{pin_create_method:"repin"},modalTitle:p,setModalTitle:m,shouldRenderContent:s,updateDescription:d}))});const{experience:t,showRepinOnInitialRender:n}=e;this.state={isFPE:!!t&&y.includes(t.experience_id),isRepinModalOpen:n||!1}}componentDidMount(){const{onMount:e}=this.props;e&&e()}shouldComponentUpdate(e,t){return!this.isFPERemoved(e)}isFPERemoved(e){const{isFPE:t}=this.state,{experience:n}=e;return t&&(!n||!y.includes(n.experience_id))}renderFPE(){const{completePinSave:e,experience:t,pin:n}=this.props;return a.a.createElement(r.b,{accessibilityModalLabel:o.a._("Create board","Accessible create board education modal label","Accessible create board education modal label"),heading:o.a._("Create board","Create board education modal label","Create board education modal label"),onDismiss:this.handleRepinHideAndToggle,size:"lg"},a.a.createElement(h.d,{dangerouslySetInlineStyle:{__style:{marginBottom:64}}},a.a.createElement(c.a,null,a.a.createElement(a.a.StrictMode,null,a.a.createElement(C,{anchorRef:this.saveButtonRef.current,experience:t,isInModal:!0,onClose:this.handleRepinHideAndToggle,onComplete:e,pin:n,pwtAuxData:{pin_create_method:"repin"}})))))}render(){const{icon:e,iconOnly:t,isCloseupPin:n,oneTapSave:s,pin:o,renderPinSaveTooltip:r,requestContext:c,variant:l,viewerId:u}=this.props,d=!!(o.pinner.id===u||o.saved||o.savedInfo||"controlled"===(null==s?void 0:s.type)&&s.saved),p="controlled"===(null==s?void 0:s.type)?"controlled":"classic";return a.a.createElement(i.Fragment,null,a.a.createElement(h.d,{ref:this.saveButtonRef},n?a.a.createElement(m.a,{icon:e,iconOnly:t,isCloseupPin:n,isPulsarDisplayed:!this.state.isRepinModalOpen,onClick:this.handleSaveButtonClick,onSavedClick:this.handleSavedButtonClick,requestContext:c,saveButtonType:p,saved:d,variant:l}):a.a.createElement(m.b,{icon:e,iconOnly:t,isCloseupPin:n,onClick:this.handleSaveButtonClick,onSavedClick:this.handleSavedButtonClick,requestContext:c,saveButtonType:p,saved:d,variant:l}),this.renderPinToBoardRepin()),!!r&&this.saveButtonRef.current&&r(this.saveButtonRef.current))}}S(O,"defaultProps",{anchorString:""}),t.default=Object(g.compose)(Object(s.connect)((function({pins:e,viewer:t},{pin:n}){return{email:t.isAuth?t.email:void 0,isAuth:t.isAuth,pinSavedInfo:e[n.id]&&e[n.id].savedInfo,viewerId:t.isAuth?t.id:""}}),(function(e){return{completePinSave:()=>e({type:"COMPLETE_PIN_SAVE"})}})),l.a,Object(u.a)(33),b.a,v.e)((function(e){const t=Object(f.b)();return a.a.createElement(O,Object.assign({},e,{boardPickerStopwatch:t}))}))},w70y:function(e,t,n){n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var i=n("q1tI"),a=n.n(i),s=n("/MKj"),o=n("lSCD"),r=n.n(o),c=n("aK+E"),l=n("zLLH"),u=n("y19s"),h=n("Wer7");const d={};function p({acceptPrefetch:e,allowStale:t,enabledRouteRefresh:n,dangerouslyDisableFetch:a,options:o,name:r,headers:p}){const m=Object(s.useDispatch)(),b=Object(c.a)(o),_=Object(i.useRef)(),f=e=>(e[r]||d)[b]||d,{isPrefetch:v,nextBookmark:g,prefetchHasBeenRead:S}=Object(s.useSelector)(({resources:e})=>f(e.data)),C=Object(s.useSelector)(({resources:e})=>f(e.data).data),y=Object(s.useSelector)(({resources:e})=>f(e.data).error),O=Object(s.useSelector)(({resources:e})=>Boolean((e.fetching[r]||d)[b])),x=Object(s.useSelector)(({resources:e})=>Boolean((e.data[r]||d)[b])),{history:P}=Object(u.b)(),D=P&&"POP"!==P.action,j=Boolean(x&&n&&D&&!a),[E,B]=Object(i.useState)(j);void 0===_.current&&x&&D&&e&&v&&!S&&!a&&m(Object(h.h)(r,o));const R=Object(i.useCallback)(()=>{a||m(Object(h.a)(r,o,p))},[a,m,p,r,b]),A=Object(i.useCallback)(()=>{a||m(Object(h.d)(r,o,p))},[a,p,r,b]),T=Object(i.useCallback)(()=>{a||(R(),B(!0))},[a,R,B]),k=Object(i.useRef)({data:void 0,error:void 0,fetchMore:A,isAtEnd:!1,isFetching:!1,isLoaded:!1,isPrefetch:void 0,isRefreshing:!1,nextBookmark:void 0,prefetchHasBeenRead:void 0,refreshData:T});Object(i.useEffect)(()=>{!1!==t&&x&&!j||R()},[]),Object(i.useEffect)(()=>{void 0!==_.current&&b!==_.current&&D&&R(),_.current=b},[b]);const w={data:C,error:y,fetchMore:A,isAtEnd:x&&!O&&g===l.a,isFetching:O,isLoaded:x,isPrefetch:v,isRefreshing:E,nextBookmark:g,prefetchHasBeenRead:S,refreshData:T};return Object(s.shallowEqual)(w,k.current)||(!E||j||Object(s.shallowEqual)(w.data,k.current.data)||(w.isRefreshing=!1,B(!1)),k.current=w),k.current}function m(e){const t=e.key;return function(n){function i(i){const{dangerouslyDisableFetch:s,options:o,key:c,...l}=e,u=p({...l,options:(r()(o)?o(i):o)||{},dangerouslyDisableFetch:!!s&&s(i)}),h={[t]:u};return a.a.createElement(n,Object.assign({},i,h))}return i.displayName=`withResourceExperimental[${e.name}](${n.displayName||n.name||""})`,i.WrappedComponent=n,i}}},y9Ij:function(e,t,n){n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return b}));var i=n("q1tI"),a=n.n(i),s=(n("PNKV"),n("TSYQ")),o=n.n(s),r=n("Ye/N"),c=n("n02X"),l=n("/5zs"),u=n("n6mq");function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const d=32,p=13;class m extends a.a.PureComponent{constructor(...e){super(...e),h(this,"handleKeyPress",e=>{e.charCode!==d&&e.charCode!==p||(e.preventDefault(),this.props.onClick(e))})}render(){const{disabled:e,iconOnly:t,isCloseupPin:n,onClick:i,onSavedClick:s,requestContext:c,saveButtonType:h,saved:d,variant:p}=this.props;if(d&&"controlled"===h)return a.a.createElement(u.e,{disabled:!0,text:r.a._("Saved"),size:"sm"});if(d&&"classic"===h&&n&&c){const e=new l.b(c,"web_save_to_saved");if(e.check("enabled")||e.check("enabled_board"))return a.a.createElement(u.e,{accessibilityLabel:r.a._("Saved button","saveButton.saved.label","Saved state label on save button"),text:r.a._("Saved!","saveButton.saved","Saved state text on save button"),size:"md",color:"white",onClick:e.check("enabled_board")?s:({event:e})=>i(e)})}return t?a.a.createElement("div",{"data-test-id":"SaveButton"},a.a.createElement(u.r,{accessibilityLabel:r.a._("Save","Accessibility label for the save button","Accessibility label for the save button"),bgColor:"white",icon:"pin",onClick:({event:e})=>i(e),iconColor:"darkGray"})):a.a.createElement("div",{className:o()("SaveButton",e?"SaveButton--disabled":"SaveButton--enabled",{"SaveButton--lego":"lego"===p}),"data-test-id":"SaveButton",onClick:e?void 0:i,onKeyPress:e?void 0:this.handleKeyPress,role:"button",tabIndex:"0"},a.a.createElement("div",{className:o()("SaveButton__background",e?"SaveButton__background--disabled":"SaveButton__background--enabled",{"SaveButton__background--lego":"lego"===p})},a.a.createElement(u.d,{alignItems:"center",minHeight:40,dangerouslySetInlineStyle:{__style:{padding:"10px 14px"}},display:"flex"},a.a.createElement(u.R,{color:e?"gray":"white",size:"lego"===p?"sm":"md",weight:"bold"},a.a.createElement("span",{className:o()("SaveButton__label",{"SaveButton__label--lego":"lego"===p})},r.a._("Save","Pin save button label","Pin save button label"))))))}}h(m,"defaultProps",{disabled:!1,icon:!0,saveButtonType:"classic",variant:"classic"});const b=Object(c.a)(".PinActionBar .repin.pinActionBarButton")(m)}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/js/PinSaveButtonCommon-08406c03fdad3e482b2a.mjs.map